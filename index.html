<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kasir Lokal â€” No Confirm/Alert</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f7f7f7}
h2{margin-top:30px}
.container{display:flex;flex-wrap:wrap;gap:20px}
section{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);flex:1;min-width:300px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
input,button,select{padding:5px;margin:3px}
button{cursor:pointer}
</style>
</head>
<body>
<h1>ðŸ’» Kasir Lokal â€” Tanpa Popup</h1>

<div class="container">
  <!-- Produk -->
  <section>
    <h2>Produk</h2>
    <input id="newName" placeholder="Nama Produk">
    <input id="newPrice" type="number" placeholder="Harga">
    <button id="btnAddProduct">Tambah</button>
    <table id="tblProducts">
      <thead><tr><th>Nama</th><th>Harga</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Keranjang -->
  <section>
    <h2>Keranjang</h2>
    <select id="selProduct"></select>
    <input id="qty" type="number" min="1" value="1">
    <button id="btnAddCart">Tambah ke Keranjang</button>
    <table id="tblCart">
      <thead><tr><th>Produk</th><th>Qty</th><th>Total</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
    <p>Total: <span id="cartTotal">0</span></p>
    <input id="paid" type="number" placeholder="Bayar">
    <button id="btnPay">Bayar & Cetak</button>
  </section>
</div>

<div class="container">
  <!-- Laporan -->
  <section>
    <h2>Laporan</h2>
    <table id="tblReport">
      <thead><tr><th>ID</th><th>Total</th><th>Status</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ekspor/Impor -->
  <section>
    <h2>Ekspor / Impor</h2>
    <button id="btnExport">Ekspor Data</button>
    <input type="file" id="fileImport">
    <button id="btnClearAll">Reset Semua</button>
  </section>
</div>

<script>
const PRODUCTS_KEY='kasir_products';
const CART_KEY='kasir_cart';
const TX_KEY='kasir_transactions';

let products=JSON.parse(localStorage.getItem(PRODUCTS_KEY)||'[]');
let cart=JSON.parse(localStorage.getItem(CART_KEY)||'[]');
let transactions=JSON.parse(localStorage.getItem(TX_KEY)||'[]');

function saveAll(){
  localStorage.setItem(PRODUCTS_KEY,JSON.stringify(products));
  localStorage.setItem(CART_KEY,JSON.stringify(cart));
  localStorage.setItem(TX_KEY,JSON.stringify(transactions));
}
function formatRp(n){return 'Rp'+n.toLocaleString('id-ID');}

function renderProducts(){
  let tb=document.querySelector('#tblProducts tbody');
  tb.innerHTML='';
  products.forEach(p=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td><td>${formatRp(p.price)}</td>
    <td><button onclick="editProduct('${p.id}')">Edit</button>
        <button onclick="delProduct('${p.id}')">Hapus</button></td>`;
    tb.appendChild(tr);
  });
  let sel=document.getElementById('selProduct');
  sel.innerHTML='';
  products.forEach(p=>{
    let opt=document.createElement('option');
    opt.value=p.id; opt.textContent=p.name+' - '+formatRp(p.price);
    sel.appendChild(opt);
  });
}
function renderCart(){
  let tb=document.querySelector('#tblCart tbody');
  tb.innerHTML=''; let total=0;
  cart.forEach(c=>{
    let p=products.find(x=>x.id==c.pid);
    if(!p) return;
    let subtotal=p.price*c.qty; total+=subtotal;
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td><td>${c.qty}</td><td>${formatRp(subtotal)}</td>
    <td><button onclick="delCart('${c.pid}')">X</button></td>`;
    tb.appendChild(tr);
  });
  document.getElementById('cartTotal').textContent=formatRp(total);
}
function renderReport(){
  let tb=document.querySelector('#tblReport tbody');
  tb.innerHTML='';
  transactions.forEach(t=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${t.id}</td><td>${formatRp(t.total)}</td><td>${t.status}</td>
    <td>${t.status==='paid'
      ?`<button onclick="voidTx('${t.id}')">Void</button>`
      :`<button onclick="restoreTx('${t.id}')">Restore</button>`}</td>`;
    tb.appendChild(tr);
  });
}

document.getElementById('btnAddProduct').onclick=()=>{
  let name=document.getElementById('newName').value.trim();
  let price=parseInt(document.getElementById('newPrice').value);
  if(!name||!price) return;
  products.push({id:Date.now().toString(),name,price});
  saveAll(); renderProducts();
  document.getElementById('newName').value='';
  document.getElementById('newPrice').value='';
};
function editProduct(id){
  let p=products.find(x=>x.id==id);
  if(!p) return;
  let name=prompt('Nama baru:',p.name);
  let price=parseInt(prompt('Harga baru:',p.price));
  if(name&&price){ p.name=name;p.price=price; saveAll(); renderProducts(); }
}
function delProduct(id){
  products=products.filter(x=>x.id!=id); saveAll(); renderProducts();
}

document.getElementById('btnAddCart').onclick=()=>{
  let pid=document.getElementById('selProduct').value;
  let qty=parseInt(document.getElementById('qty').value)||1;
  let f=cart.find(x=>x.pid==pid);
  if(f) f.qty+=qty; else cart.push({pid,qty});
  saveAll(); renderCart();
};
function delCart(pid){ cart=cart.filter(c=>c.pid!=pid); saveAll(); renderCart(); }

document.getElementById('btnPay').onclick=()=>{
  let total=cart.reduce((a,c)=>a+(products.find(p=>p.id==c.pid)?.price||0)*c.qty,0);
  let paid=parseInt(document.getElementById('paid').value)||0;
  if(paid<total) return;
  let tx={id:'TX'+Date.now(),items:[...cart],total,paid,status:'paid'};
  transactions.push(tx); cart=[]; saveAll(); renderCart(); renderReport();
};

function voidTx(id){ let tx=transactions.find(t=>t.id==id); if(tx){tx.status='voided'; saveAll(); renderReport();}}
function restoreTx(id){ let tx=transactions.find(t=>t.id==id); if(tx){tx.status='paid'; saveAll(); renderReport();}}

document.getElementById('btnExport').onclick=()=>{
  let data={products,transactions};
  let blob=new Blob([JSON.stringify(data)],{type:'application/json'});
  let a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='kasir_data.json'; a.click();
};
document.getElementById('fileImport').onchange=(e)=>{
  let f=e.target.files[0]; if(!f) return;
  let r=new FileReader(); r.onload=()=>{
    let data=JSON.parse(r.result);
    products=data.products||[]; transactions=data.transactions||[];
    cart=[]; saveAll(); renderProducts(); renderCart(); renderReport();
  }; r.readAsText(f);
};
document.getElementById('btnClearAll').onclick=()=>{
  localStorage.removeItem(PRODUCTS_KEY);
  localStorage.removeItem(CART_KEY);
  localStorage.removeItem(TX_KEY);
  location.reload();
};

renderProducts(); renderCart(); renderReport();
</script>
</body>
</html>
